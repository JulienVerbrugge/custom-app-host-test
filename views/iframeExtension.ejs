<h1>Akeneo Iframe Extension</h1>
<button id="requestJwtButton">Request JWT</button>
<button id="verifyJwtButton" style="display:none;">Verify JWT</button>
<pre id="tokenDisplay" style="display:none;"></pre>
<pre id="decodedToken" style="display:none;"></pre>
<pre id="verificationResult" style="display:none;"></pre>

<script>
    let jwt = '';

    document.getElementById('requestJwtButton').addEventListener('click', function() {
        // Request the JWT from the parent window
        window.parent.postMessage({ type: 'request_jwt' }, "*");
    });

    // Listen for messages from the parent window
    window.addEventListener('message', function(event) {
        if (event.data.type === 'JWT_TOKEN') {
            jwt = event.data.token;
            document.getElementById('tokenDisplay').textContent = jwt;
            document.getElementById('tokenDisplay').style.display = 'block';

            // Decode the JWT
            const payload = jwt.split('.')[1]; // Get the payload part
            const decodedPayload = JSON.parse(atob(payload)); // Decode base64
            document.getElementById('decodedToken').textContent = JSON.stringify(decodedPayload, null, 2);
            document.getElementById('decodedToken').style.display = 'block';

            // Show the verify button
            document.getElementById('verifyJwtButton').style.display = 'block';
        }
    });

    document.getElementById('verifyJwtButton').addEventListener('click', function() {
        fetch('/verify-token', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ token: jwt })
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('verificationResult').textContent = JSON.stringify(data, null, 2);
            document.getElementById('verificationResult').style.display = 'block';
        })
        .catch(error => {
            console.error('Error verifying token:', error);
        });
    });
</script>
